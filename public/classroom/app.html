<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link href='https://fonts.googleapis.com/css?family=Cabin' rel='stylesheet'>
  </head>
  <body>
    <font style="font-family: 'Cabin';">
      <button id="b">Request</button>
      <br>
      <p id="p">hi test<br></p>
    </font>
    <script src="http://code.jquery.com/jquery-2.1.0.js"></script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      var httpReq = function(method, url, access_token, cb){
        var req = new XMLHttpRequest();
        req.open(method, url);
        if (access_token!==undefined)req.setRequestHeader("Authorization", "Bearer " + access_token);
        req.send();
        req.onload = function(){
          if (req.readyState === 4){
            cb(JSON.parse(req.responseText), undefined);
          } else {
            cb(undefined, "not ready err")
          }
        }
      }
      var accessToken = urlParams.has("access_token")?urlParams.get("access_token"):undefined;

      var totalItems = [];
      document.getElementById("b").addEventListener("click", ()=>{
        httpReq("GET", "https://classroom.googleapis.com/v1/courses", accessToken, (data, err)=>{
          var thing = function(ind){

            var pushGreatestLeast = function(arr, dest){
              for (var j=0;j<arr.length;j++){
                  for (var k=0;k<dest.length;k++){ //order of greatest to least
                    if (new Date(arr[j].creationTime).getTime()>new Date(dest[k].creationTime).getTime()){ //if the new item is lower than the current, then it needs to go lower and deeper into the array
                      dest.splice(k,0,arr[j]);
                    }else if (new Date(arr[j].creationTime).getTime()===new Date(dest[k].creationTime).getTime()){
                      var pos=0;
                      (function greaterThan(indox){
                        if (arr[j].title.charAt(indox).toUpperCase()>dest[k].title.charAt(indox).toUpperCase){
                          dest.splice(k,0,arr[j]);
                        }else if(arr[j].title.charAt(indox).toUpperCase()<dest[k].title.charAt(indox).toUpperCase){
                          dest.splice(k+1,0,arr[j]);
                        }else {
                          pos++
                          return greaterThan(pos);
                        }
                      })(pos);
                    }else{
                      if (k===dest.length-1){
                        dest.splice(k,0,arr[j]);
                      }
                    }
                  }
                }
            }

            httpReq("GET", "https://classroom.googleapis.com/v1/courses/"+ind+"/courseWorkMaterials", accessToken, (data, err)=>{
              if (err) console.log(err);
              else{
                //for loop and sort the push into the loop
                if (totalItems.length===0){
                  for (var a=0;a<data.courseWork.length;a++){
                    totalItems.push(data.courseWork[i]);
                  }
                }
                pushGreatestLeast(data.courseWork, totalItems);
                
              }
            })
            httpReq("GET", "https://classroom.googleapis.com/v1/courses/"+ind+"/announcements", accessToken, (data, err)=>{
              if (err) console.log(err);
              else{
                //for loop and sort the push into the loop
                if (totalItems.length===0){
                  for (var a=0;a<data.courseWorkMaterial.length;a++){
                    totalItems.push(data.courseWorkMaterial[i]);
                  }
                }
                pushGreatestLeast(data.courseWorkMaterial, totalItems);
                
              }
            })
            httpReq("GET", "https://classroom.googleapis.com/v1/courses/"+ind+"/courseWork", accessToken, (data, err)=>{
              if (err) console.log(err);
              else{
                //for loop and sort the push into the loop
                if (totalItems.length===0){
                  for (var a=0;a<data.announcements.length;a++){
                    totalItems.push(data.announcements[i]);
                  }
                }
                pushGreatestLeast(data.announcements, totalItems);
                
              }
            })
            //make rest of http calls and put them here (ie copy the top httpReq block for each url)
            
          }
          for(var i=0;i<data.courses.length;i++){
            thing(data.courses[i].id);
          }
        })
      })
    </script>
  </body>
</html>